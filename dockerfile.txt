# 1. 直接使用你本地已存在的成功镜像作为底座
# (Docker 会直接找你电脑里的这个名字，不再去 Docker Hub 下载)
FROM fx_agent_n99-fx-brain:latest

# 2. 设置工作目录
WORKDIR /app

# 3. 【关键】清理掉旧镜像里自带的代码，确保环境纯净
# 防止旧项目代码干扰新项目
RUN rm -rf /app/*

# 4. 复制依赖文件
COPY requirements.txt .

# 5. 安装依赖
# 即使底座里可能已经装过，这里再运行一次确保万无一失
# 使用阿里云镜像源防止报错，加上 --trusted-host 解决 SSL 问题
RUN pip install --no-cache-dir -r requirements.txt \
    -i https://mirrors.aliyun.com/pypi/simple/ \
    --trusted-host mirrors.aliyun.com

# 6. 复制新代码
COPY app ./app

# 7. 启动命令
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8002"]
